apiVersion: v1
kind: Namespace
metadata:
  name: default
  labels:
    policy.sigstore.dev/include: "true"
  annotations:
    kubectl.kubernetes.io/last-applied-configuration: |
      {"apiVersion":"v1","kind":"Namespace","metadata":{"annotations":{},"labels":{},"name":"default"}}
---
apiVersion: v1
kind: Namespace
metadata:
  name: cosign-system
---
# Source: policy-controller/templates/policy-webhook/sa_policy_webhook.yaml
apiVersion: v1
kind: ServiceAccount
metadata:
  labels:
    helm.sh/chart: policy-controller-0.5.5
    app.kubernetes.io/name: policy-controller
    app.kubernetes.io/instance: policy-controller
    app.kubernetes.io/version: "0.7.0"
    app.kubernetes.io/managed-by: Helm
    control-plane: policy-controller-policy-webhook
  name: policy-controller-policy-webhook
  namespace: cosign-system
---
# Source: policy-controller/templates/webhook/sa_webhook.yaml
apiVersion: v1
kind: ServiceAccount
metadata:
  labels:
    helm.sh/chart: policy-controller-0.5.5
    app.kubernetes.io/name: policy-controller
    app.kubernetes.io/instance: policy-controller
    app.kubernetes.io/version: "0.7.0"
    app.kubernetes.io/managed-by: Helm
    control-plane: policy-controller-webhook
  name: policy-controller-webhook
  namespace: cosign-system
---
# Source: policy-controller/templates/policy-webhook/secret_certs_policy_webhook.yaml
apiVersion: v1
kind: Secret
metadata:
  annotations:
  labels:
    helm.sh/chart: policy-controller-0.5.5
    app.kubernetes.io/name: policy-controller
    app.kubernetes.io/instance: policy-controller
    app.kubernetes.io/version: "0.7.0"
    app.kubernetes.io/managed-by: Helm
    control-plane: policy-controller-policy-webhook
  name: policy-webhook-certs
  namespace: cosign-system
# The data is populated at install time.
---
# Source: policy-controller/templates/webhook/secret_certs_webhook.yaml
apiVersion: v1
kind: Secret
metadata:
  annotations:
  labels:
    helm.sh/chart: policy-controller-0.5.5
    app.kubernetes.io/name: policy-controller
    app.kubernetes.io/instance: policy-controller
    app.kubernetes.io/version: "0.7.0"
    app.kubernetes.io/managed-by: Helm
    control-plane: policy-controller-webhook
  name: webhook-certs
  namespace: cosign-system
# The data is populated at install time.
---
# Source: policy-controller/templates/policy-webhook/config-sigstore-keys.yaml
# Copyright 2022 The Sigstore Authors.
#
# Licensed under the Apache License, Version 2.0 (the "License");
# you may not use this file except in compliance with the License.
# You may obtain a copy of the License at
#
#     http://www.apache.org/licenses/LICENSE-2.0
#
# Unless required by applicable law or agreed to in writing, software
# distributed under the License is distributed on an "AS IS" BASIS,
# WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
# See the License for the specific language governing permissions and
# limitations under the License.

apiVersion: v1
kind: ConfigMap
metadata:
  name: config-sigstore-keys
  namespace: cosign-system

data:
  _example: |
    ##################################
    #                                #
    #    EXAMPLE CONFIGURATION       #
    #                                #
    #                                #
    # my-custom-sigstore-keys: |-    
    #  {"certificateAuthority":[{"subject":{"organization":"fulcio-organization","commonName":"fulcio-common-name"},"uri":"https://fulcio.example.com","certChain":"LS0tLS1CRUdJTiBDRVJUSUZJQ0FURS0tLS0tCglNSUlGd3pDQ0E2dWdBd0lCQWdJSUs3eGIrcnFZNGdFd0RRWUpLb1pJaHZjTkFRRUxCUUF3ZmpFTU1Bb0dBMVVFCglCaE1EVlZOQk1STXdFUVlEVlFRSUV3cERZV3hwWm05eWJtbGhNUll3RkFZRFZRUUhFdzFUWVc0Z1JuSmhibU5wCgljMk52TVJZd0ZBWURWUVFKRXcwMU5EZ2dUV0Z5YTJWMElGTjBNUTR3REFZRFZRUVJFd1UxTnpJM05ERVpNQmNHCglBMVVFQ2hNUVRHbHVkWGdnUm05MWJtUmhkR2x2YmpBZUZ3MHlNakV5TURnd01qRTNOVEZhRncweU16RXlNRGd3CglNakUzTlRGYU1INHhEREFLQmdOVkJBWVRBMVZUUVRFVE1CRUdBMVVFQ0JNS1EyRnNhV1p2Y201cFlURVdNQlFHCglBMVVFQnhNTlUyRnVJRVp5WVc1amFYTmpiekVXTUJRR0ExVUVDUk1OTlRRNElFMWhjbXRsZENCVGRERU9NQXdHCglBMVVFRVJNRk5UY3lOelF4R1RBWEJnTlZCQW9URUV4cGJuVjRJRVp2ZFc1a1lYUnBiMjR3Z2dJaU1BMEdDU3FHCglTSWIzRFFFQkFRVUFBNElDRHdBd2dnSUtBb0lDQVFDMTQyRWpsZzJReEl3cE5qYmFlVy9mdDlzSDFUWFU2Q1dnCglic3ZWcDc3dlJnY2tTbnBNM1JUQy9nd0V3Skh0WCtHT1RyUDlybzZuRkpOM0czaGNGbmFNSExLZEdyb2Y5aUh1Cgkvdy9sWkx3UXpYelZUKzBaeVp4eXRIQVdHRkJ2bVlNNEozM2pINkRqOVB2cU9Od3RTQlNtWkJQYy9ILzhFdllzCglVenhQV3VraE90b3RTSDNWWERxWjRqbDk2TUxlMCs1ZzJXaTdNeFJYNDRYMVJpUFMxNGJhMUVTNTM4YlRoaGNRCgk0U01qM3VoYmRzQ0lrY203ZUY0RVkzcEVYUXBYRUVHblpHZndZZ1FyKzZjVDA3WmQvV0RNME5YM0t4SDZxUms5CglnRGpQbmZjTXVGYk9UYmZEL251dng2Rk5YNk9VcnpyWlNnbGtMdmNQSUJWT1c3TG40MUxBYjdhWG1iV0xGRUpuCgl1TG9vUHBZWXIrNk5obkZETkdwc0JLR0tyL2t2YlF5REtLc3QzQ0tqOW90UFMxMzYzbmk0MXFub0E3WVdTcXh3Cgl6NDE4NWRLS2MrWTd5dkpRc1JscjZxRzFzTkxPK2M3N2ZTUzVWWkltek5vekJjUmt1TEpGbFgrV0IwdXpnUVU1CglzNDVJWlcrZks5Mm5mdThNbUtqekhSK2lkeXI0T3lqUzBZU04zR01nYzBVUDdLNmhWcGhMZWRBcEZweWtCU0ZHCglVZ2lQWndyVCttR1NWZ21PWHE1bjFkUVRDRDE0bEVoMnF0My9yZmY4ek5jMENNQU5XeWJhTUdCR1E0YmhWVlhlCglSS1l4OXUyUFpqUHY1M3A3WWIvRENkcW5HRUR3L0hDQkRpQ3M0b1llNGRhRTM2eFVvanhEU20zRGFlTkc2OHo5CglSTDdnZlVqQXhRSURBUUFCbzBVd1F6QU9CZ05WSFE4QkFmOEVCQU1DQVFZd0VnWURWUjBUQVFIL0JBZ3dCZ0VCCgkvd0lCQVRBZEJnTlZIUTRFRmdRVWYrbGJOWDBXaDRoK1EwU1J0aFJLK0tmTGpxRXdEUVlKS29aSWh2Y05BUUVMCglCUUFEZ2dJQkFFaEpqYTBaU0t3WGNhT1hDWVJYVEUwNitKYnBlekk1TGV2QmhtYlJRSzc4OVJxMTBKZUFYYTdtCglFVG9SR2xHRkxIMnVEVDExbXNGS3lNM3Y2N0tsRTFTWVZjcUttQ2xZZklWRVlIM0xhMHVJKzlySFpuV2diNEJsCgl5MUI4d2JsS0p6aFlRRDlaNEgvZ3MrQkFzb1JYNVZvRnlJZ2tOQmsxcDNmdGFWQ2JrUXZTME9ZdFlzNWl3NGVLCgljSTcxL0lzVElUM1pwcGo5UjhJR3Nxd0xLZ3pmbnlOY0ZKZHorb2hjNlYyMlBqWk1FQkhDc0hQTzRhdjJMbFdLCgk1WTFmbEwrMmJxVHFibU8vYmpmWDB3NFoxRHVvalJjT1pGN1NINE8zUXUyWTcvNjlnSDdDcDBuaVZDbTV6K1M1CgkwMTFWNlB2TWpybWlFK3hWa3hMSGJZRWdvY2JGaGQ1RGNpTUNYcHZzdURab2phSTNGUkVtQnFpSWhLb2tpM3JiCgl3dUVseWE3OGJNd2taMWtycDc2bldzbzQ3LzArNTFpby9XcmlBZHIwY2ptem9uaG83UnFJRTNEQzc3Q0VNa2FnCgladktTbUwzc2ZmK1dOU3JuUGx6bksxOU5BMno0SW1XOU1zenFQckNUUUdQLy9CQnU3U2Ftem9mVk05ZjRQQUlyCglGVHBuVzZzR2RwQ3pQOEUwV1V1OUIrdmlLcnRmTS85c3huSTlXaGZKUGRyRVAwaVpXM3Zod3ZnUWJLYjVEMk9TCglVNG5yVm92NkJXci9CbmhRSzhJWG8xdHEzajhGQ1JJb2xlWE5oa3M0Z25rT2FEc1cyS3RWcXd0SzNpTzNCdlBiCglMNXcwZ2RMandNTGtlazcyeTYxWHF6NVd4WndOaGw1WWNtQkt1U3ZtVlNIdkE2OEJWU2JCCgktLS0tLUVORCBDRVJUSUZJQ0FURS0tLS0tCgk="}],"tLog":[{"baseURL":"https://rekor.example.com","hashAlgorithm":"sha-256","publicKey":"LS0tLS1CRUdJTiBQVUJMSUMgS0VZLS0tLS0KCU1Ga3dFd1lIS29aSXpqMENBUVlJS29aSXpqMERBUWNEUWdBRTdEMld2Z3FTenM5anBkSnNPSjVObDZ4ZzhKWG0KCU5tbzdNM2JONytkUWRkdzlJYmMyUjNTVjh0ekJadzByU1Q4RktjbjRhcEplcGNLTTRxVXBZVWVOZnc9PQoJLS0tLS1FTkQgUFVCTElDIEtFWS0tLS0tCgk=","logID":"rekor-log-id"}],"ctLog":[{"baseURL":"https://ctfe.example.com","hashAlgorithm":"sha-256","publicKey":"LS0tLS1CRUdJTiBQVUJMSUMgS0VZLS0tLS0KCU1Ga3dFd1lIS29aSXpqMENBUVlJS29aSXpqMERBUWNEUWdBRUp2Q0ppNzA3ZnY1dE1KMVUyVFZNWit1TzRkS0cKCWFFY3ZqbENrZ0JDS1hicmt1bVpWMG0wZFNsSzFWMWd4RWl5UTh5NmhrMU14Sk5lMkFaclpVdDdhNHc9PQoJLS0tLS1FTkQgUFVCTElDIEtFWS0tLS0tCgk=","logID":"ctfe-log-id"}],"timestampAuthorities":[{"subject":{"organization":"tsa-organization","commonName":"tsa-common-name"},"uri":"https://tsa.example.com","certChain":"LS0tLS1CRUdJTiBDRVJUSUZJQ0FURS0tLS0tCglNSUlCekRDQ0FYS2dBd0lCQWdJVWZ5R0tEb0ZhN3k2cy9XMXAxQ2lUbUJSczFlQXdDZ1lJS29aSXpqMEVBd0l3CglNREVPTUF3R0ExVUVDaE1GYkc5allXd3hIakFjQmdOVkJBTVRGVlJsYzNRZ1ZGTkJJRWx1ZEdWeWJXVmthV0YwCglaVEFlRncweU1qRXhNRGt5TURNeE16UmFGdzB6TVRFeE1Ea3lNRE0wTXpSYU1EQXhEakFNQmdOVkJBb1RCV3h2CglZMkZzTVI0d0hBWURWUVFERXhWVVpYTjBJRlJUUVNCVWFXMWxjM1JoYlhCcGJtY3dXVEFUQmdjcWhrak9QUUlCCglCZ2dxaGtqT1BRTUJCd05DQUFSM0tjRHk5andBUlgwckR2eXIrTUdHa0czbjFPQTBNVTUrWmlEbWd1c0Z5azZVCgk2Ym92S1dWTWZEOEo4TlRjSlpFMFJhWUpyOC9kRTlrZ2NJSVhsaE13bzJvd2FEQU9CZ05WSFE4QkFmOEVCQU1DCglCNEF3SFFZRFZSME9CQllFRkhObjVSM2IzTXRVZFNOckZPNDlRNlhEVlNua01COEdBMVVkSXdRWU1CYUFGTkxTCgk2Z25vN09tKytRdDV6SWErSDlvMEhpVDJNQllHQTFVZEpRRUIvd1FNTUFvR0NDc0dBUVVGQndNSU1Bb0dDQ3FHCglTTTQ5QkFNQ0EwZ0FNRVVDSVFDRjBvbG9obnZkVXE2VDcvd1BrMTlaNWFRUC95eFJUakNXWXVobi9UQ3lIZ0lnCglhelYzYWlyNEdSWmJOOWJkWXRjUTdKVUFLcTg5R09odEZmbDZrY29WVXZVPQoJLS0tLS1FTkQgQ0VSVElGSUNBVEUtLS0tLQoJLS0tLS1CRUdJTiBDRVJUSUZJQ0FURS0tLS0tCglNSUlCMGpDQ0FYaWdBd0lCQWdJVVhwQm1ZSkZGYUdXM2NDOHA2Yi9ESHIxaThJb3dDZ1lJS29aSXpqMEVBd0l3CglLREVPTUF3R0ExVUVDaE1GYkc5allXd3hGakFVQmdOVkJBTVREVlJsYzNRZ1ZGTkJJRkp2YjNRd0hoY05Nakl4CglNVEE1TWpBeU9UTTBXaGNOTXpJeE1UQTVNakF6TkRNMFdqQXdNUTR3REFZRFZRUUtFd1ZzYjJOaGJERWVNQndHCglBMVVFQXhNVlZHVnpkQ0JVVTBFZ1NXNTBaWEp0WldScFlYUmxNRmt3RXdZSEtvWkl6ajBDQVFZSUtvWkl6ajBECglBUWNEUWdBRUtEUERSSXdEUzFaQ3ltdWI2eWFuQ0c1bWEwcURqTHBOb25Edm9vU2tSSEVnVTBUTmliZUpuNk0rCgk1VzYwOGhDdzhud3V1Y01iWFE0MWtOZXVCZWV2eXFONE1IWXdEZ1lEVlIwUEFRSC9CQVFEQWdFR01CTUdBMVVkCglKUVFNTUFvR0NDc0dBUVVGQndNSU1BOEdBMVVkRXdFQi93UUZNQU1CQWY4d0hRWURWUjBPQkJZRUZOTFM2Z25vCgk3T20rK1F0NXpJYStIOW8wSGlUMk1COEdBMVVkSXdRWU1CYUFGQjFudlhwTks3QXVRbGJKK3lhNm5QU3FXaStUCglNQW9HQ0NxR1NNNDlCQU1DQTBnQU1FVUNJR2l3cUNJMjl3N0M0VjhUbHRDc2k3MjhzNUR0a2xDUHlTREFTVVN1CglhNXk1QWlFQTQwSWZkbHdmN1VqOHE4TlNENlo0Zy8wanMwdEdOZExTVUoxZG8vV29OMHM9CgktLS0tLUVORCBDRVJUSUZJQ0FURS0tLS0tCgktLS0tLUJFR0lOIENFUlRJRklDQVRFLS0tLS0KCU1JSUJsRENDQVRxZ0F3SUJBZ0lVWVp4OXNTMTRFbjdTdUhET0pKUDRJUG9wTWpVd0NnWUlLb1pJemowRUF3SXcKCUtERU9NQXdHQTFVRUNoTUZiRzlqWVd3eEZqQVVCZ05WQkFNVERWUmxjM1FnVkZOQklGSnZiM1F3SGhjTk1qSXgKCU1UQTVNakF5T1RNMFdoY05Nekl4TVRBNU1qQXpORE0wV2pBb01RNHdEQVlEVlFRS0V3VnNiMk5oYkRFV01CUUcKCUExVUVBeE1OVkdWemRDQlVVMEVnVW05dmREQlpNQk1HQnlxR1NNNDlBZ0VHQ0NxR1NNNDlBd0VIQTBJQUJBYkIKCUIwU1U4Rzc1aFZJVXBoQ2hBNG5mT3dOV1AzNDdUalNjSWRzRVByS1ZuKy9ZMUhtbUxISkRqU2ZuK3hoRUZvRWsKCTdqcWdycW9uNDhpNHhibzd4QXVqUWpCQU1BNEdBMVVkRHdFQi93UUVBd0lCQmpBUEJnTlZIUk1CQWY4RUJUQUQKCUFRSC9NQjBHQTFVZERnUVdCQlFkWjcxNlRTdXdMa0pXeWZzbXVwejBxbG92a3pBS0JnZ3Foa2pPUFFRREFnTkkKCUFEQkZBaUJlNVA1NmZvcW1GY1pBVnBFZUFPRlpyQWxFaXEwNUNDcE1OWWg1RWpMdm1BSWhBS05GNnhJVjV1RmQKCXBTVEpzQXd6alc3OENLUW03cW9sMHVQbVBQdTZtTmF3CgktLS0tLUVORCBDRVJUSUZJQ0FURS0tLS0t"}]}
    ###################################
---
# Source: policy-controller/templates/policy-webhook/configmap-clusterimagepolicy.yaml
apiVersion: v1
kind: ConfigMap
metadata:
  name: config-image-policies
  namespace: cosign-system
data:
  _example: |
    #######################################
    #                                     #
    #    EXAMPLE CONFIGURATION            #
    #                                     #
    #                                     #
    # cluster-image-policy-json: '{"images":[{"glob":"ghcr.io/example/*","regex":""}],"authorities":[{"key":{"data":"-----BEGIN PUBLIC KEY-----\\nMFkwEwYHKoZIzj0CAQYIKoZIzj0DAQcDQgAExB6+H6054/W1SJgs5JR6AJr6J35J\\nRCTfQ5s1kD+hGMSE1rH7s46hmXEeyhnlRnaGF8eMU/SBJE/2NKPnxE7WzQ==\\n-----END PUBLIC KEY-----"}}]}'
    #######################################
---
# Source: policy-controller/templates/policy-webhook/configmap-policy-controller.yaml
# Copyright 2022 The Sigstore Authors.
#
# Licensed under the Apache License, Version 2.0 (the "License");
# you may not use this file except in compliance with the License.
# You may obtain a copy of the License at
#
#     http://www.apache.org/licenses/LICENSE-2.0
#
# Unless required by applicable law or agreed to in writing, software
# distributed under the License is distributed on an "AS IS" BASIS,
# WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
# See the License for the specific language governing permissions and
# limitations under the License.

apiVersion: v1
kind: ConfigMap
metadata:
  name: config-policy-controller
  namespace: cosign-system
data:
  _example: |
    ################################
    #                              #
    #    EXAMPLE CONFIGURATION     #
    #                              #
    #                              #
    #    no-match-policy: warn     #
    ################################
---
# Source: policy-controller/templates/policy-webhook/configmap.yaml
apiVersion: v1
kind: ConfigMap
metadata:
  labels:
    helm.sh/chart: policy-controller-0.5.5
    app.kubernetes.io/name: policy-controller
    app.kubernetes.io/instance: policy-controller
    app.kubernetes.io/version: "0.7.0"
    app.kubernetes.io/managed-by: Helm
    control-plane: policy-controller-policy-webhook
  name: policy-controller-policy-webhook-logging
  namespace: cosign-system
data:
  zap-logger-config: |-
    {
      "level": "info",
      "development": false,
      "outputPaths": ["stdout"],
      "errorOutputPaths": ["stderr"],
      "encoding": "json",
      "encoderConfig": {
        "timeKey": "ts",
        "levelKey": "level",
        "nameKey": "logger",
        "callerKey": "caller",
        "messageKey": "msg",
        "stacktraceKey": "stacktrace",
        "lineEnding": "",
        "levelEncoder": "",
        "timeEncoder": "iso8601",
        "durationEncoder": "",
        "callerEncoder": ""
      }
    }
  # Log level overrides
  # Changes are be picked up immediately.
  loglevel.controller: "info"
  loglevel.webhook: "info"
---
# Source: policy-controller/templates/webhook/configmap.yaml
apiVersion: v1
kind: ConfigMap
metadata:
  labels:
    helm.sh/chart: policy-controller-0.5.5
    app.kubernetes.io/name: policy-controller
    app.kubernetes.io/instance: policy-controller
    app.kubernetes.io/version: "0.7.0"
    app.kubernetes.io/managed-by: Helm
    control-plane: policy-controller-webhook
  name: policy-controller-webhook-logging
  namespace: cosign-system
data:
  zap-logger-config: |-
    {
      "level": "info",
      "development": false,
      "outputPaths": ["stdout"],
      "errorOutputPaths": ["stderr"],
      "encoding": "json",
      "encoderConfig": {
        "timeKey": "ts",
        "levelKey": "level",
        "nameKey": "logger",
        "callerKey": "caller",
        "messageKey": "msg",
        "stacktraceKey": "stacktrace",
        "lineEnding": "",
        "levelEncoder": "",
        "timeEncoder": "iso8601",
        "durationEncoder": "",
        "callerEncoder": ""
      }
    }
  # Log level overrides
  # Changes are be picked up immediately.
  loglevel.controller: "info"
  loglevel.webhook: "info"
---
# Source: policy-controller/templates/crds/clusterimagepolicy.yaml
# Copyright 2022 The Sigstore Authors.
#
# Licensed under the Apache License, Version 2.0 (the "License");
# you may not use this file except in compliance with the License.
# You may obtain a copy of the License at
#
#     https://www.apache.org/licenses/LICENSE-2.0
#
# Unless required by applicable law or agreed to in writing, software
# distributed under the License is distributed on an "AS IS" BASIS,
# WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
# See the License for the specific language governing permissions and
# limitations under the License.
apiVersion: apiextensions.k8s.io/v1
kind: CustomResourceDefinition
metadata:
  name: clusterimagepolicies.policy.sigstore.dev
spec:
  conversion:
    strategy: Webhook
    webhook:
      conversionReviewVersions: ["v1beta1", "v1alpha1"]
      clientConfig:
        service:
          name: policy-webhook
          namespace: cosign-system
  group: policy.sigstore.dev
  names:
    kind: ClusterImagePolicy
    plural: clusterimagepolicies
    singular: clusterimagepolicy
    categories:
      - all
      - sigstore
    shortNames:
      - cip
  scope: Cluster
  versions:
    - name: v1alpha1
      served: true
      storage: true
      subresources:
        status: {}
      schema:
        openAPIV3Schema:
          type: object
          properties:
            spec:
              description: Spec holds the desired state of the ClusterImagePolicy (from the client).
              type: object
              properties:
                authorities:
                  description: Authorities defines the rules for discovering and validating signatures.
                  type: array
                  items:
                    type: object
                    properties:
                      attestations:
                        description: Attestations is a list of individual attestations for this authority, once the signature for this authority has been verified.
                        type: array
                        items:
                          type: object
                          properties:
                            name:
                              description: Name of the attestation. These can then be referenced at the CIP level policy.
                              type: string
                            policy:
                              description: Policy defines all of the matching signatures, and all of the matching attestations (whose attestations are verified).
                              type: object
                              properties:
                                configMapRef:
                                  description: ConfigMapRef defines the reference to a configMap with the policy definition.
                                  type: object
                                  properties:
                                    key:
                                      description: Key defines the key to pull from the configmap.
                                      type: string
                                    name:
                                      description: Name is unique within a namespace to reference a configmap resource.
                                      type: string
                                    namespace:
                                      description: Namespace defines the space within which the configmap name must be unique.
                                      type: string
                                data:
                                  description: Data contains the policy definition.
                                  type: string
                                fetchConfigFile:
                                  description: 'FetchConfigFile controls whether ConfigFile will be fetched and made available for CIP level policy evaluation. Note that this only gets evaluated (and hence fetched) iff at least one authority matches. The ConfigFile will then be available in this format: https://github.com/opencontainers/image-spec/blob/main/config.md'
                                  type: boolean
                                includeObjectMeta:
                                  description: IncludeObjectMeta controls whether the ObjectMeta will be included and made available for CIP level policy evalutation. Note that this only gets evaluated iff at least one authority matches.
                                  type: boolean
                                includeSpec:
                                  description: IncludeSpec controls whether resource `Spec` will be included and made available for CIP level policy evaluation. Note that this only gets evaluated iff at least one authority matches. Also note that because Spec may be of a different shape depending on the resource being evaluatied (see MatchResource for filtering) you might want to configure these to match the policy file to ensure the shape of the Spec is what you expect when evaling the policy.
                                  type: boolean
                                includeTypeMeta:
                                  description: IncludeTypeMeta controls whether the TypeMeta will be included and made available for CIP level policy evalutation. Note that this only gets evaluated iff at least one authority matches.
                                  type: boolean
                                remote:
                                  description: Remote defines the url to a policy.
                                  type: object
                                  properties:
                                    sha256sum:
                                      description: Sha256sum defines the exact sha256sum computed out of the 'body' of the http response.
                                      type: string
                                    url:
                                      description: URL to the policy data.
                                      type: string
                                type:
                                  description: Which kind of policy this is, currently only rego or cue are supported. Furthermore, only cue is tested :)
                                  type: string
                            predicateType:
                              description: PredicateType defines which predicate type to verify. Matches cosign verify-attestation options.
                              type: string
                      ctlog:
                        description: CTLog sets the configuration to verify the authority against a Rekor instance.
                        type: object
                        properties:
                          trustRootRef:
                            description: Use the Public Key from the referred TrustRoot.TLog
                            type: string
                          url:
                            description: URL sets the url to the rekor instance (by default the public rekor.sigstore.dev)
                            type: string
                      key:
                        description: Key defines the type of key to validate the image.
                        type: object
                        properties:
                          data:
                            description: Data contains the inline public key.
                            type: string
                          hashAlgorithm:
                            description: HashAlgorithm always defaults to sha256 if the algorithm hasn't been explicitly set
                            type: string
                          kms:
                            description: KMS contains the KMS url of the public key Supported formats differ based on the KMS system used.
                            type: string
                          secretRef:
                            description: SecretRef sets a reference to a secret with the key.
                            type: object
                            properties:
                              name:
                                description: name is unique within a namespace to reference a secret resource.
                                type: string
                              namespace:
                                description: namespace defines the space within which the secret name must be unique.
                                type: string
                      keyless:
                        description: Keyless sets the configuration to verify the authority against a Fulcio instance.
                        type: object
                        properties:
                          ca-cert:
                            description: CACert sets a reference to CA certificate
                            type: object
                            properties:
                              data:
                                description: Data contains the inline public key.
                                type: string
                              hashAlgorithm:
                                description: HashAlgorithm always defaults to sha256 if the algorithm hasn't been explicitly set
                                type: string
                              kms:
                                description: KMS contains the KMS url of the public key Supported formats differ based on the KMS system used.
                                type: string
                              secretRef:
                                description: SecretRef sets a reference to a secret with the key.
                                type: object
                                properties:
                                  name:
                                    description: name is unique within a namespace to reference a secret resource.
                                    type: string
                                  namespace:
                                    description: namespace defines the space within which the secret name must be unique.
                                    type: string
                          identities:
                            description: Identities sets a list of identities.
                            type: array
                            items:
                              type: object
                              properties:
                                issuer:
                                  description: Issuer defines the issuer for this identity.
                                  type: string
                                issuerRegExp:
                                  description: IssuerRegExp specifies a regular expression to match the issuer for this identity.
                                  type: string
                                subject:
                                  description: Subject defines the subject for this identity.
                                  type: string
                                subjectRegExp:
                                  description: SubjectRegExp specifies a regular expression to match the subject for this identity.
                                  type: string
                          insecureIgnoreSCT:
                            description: InsecureIgnoreSCT omits verifying if a certificate contains an embedded SCT
                            type: boolean
                          trustRootRef:
                            description: Use the Certificate Chain from the referred TrustRoot.CertificateAuthorities and TrustRoot.CTLog
                            type: string
                          url:
                            description: URL defines a url to the keyless instance.
                            type: string
                      name:
                        description: Name is the name for this authority. Used by the CIP Policy validator to be able to reference matching signature or attestation verifications. If not specified, the name will be authority-<index in array>
                        type: string
                      rfc3161timestamp:
                        description: RFC3161Timestamp sets the configuration to verify the signature timestamp against a RFC3161 time-stamping instance.
                        type: object
                        properties:
                          trustRootRef:
                            description: Use the Certificate Chain from the referred TrustRoot.TimeStampAuthorities
                            type: string
                      source:
                        description: Sources sets the configuration to specify the sources from where to consume the signatures.
                        type: array
                        items:
                          type: object
                          properties:
                            oci:
                              description: OCI defines the registry from where to pull the signature / attestations.
                              type: string
                            signaturePullSecrets:
                              description: SignaturePullSecrets is an optional list of references to secrets in the same namespace as the deploying resource for pulling any of the signatures used by this Source.
                              type: array
                              items:
                                type: object
                                properties:
                                  name:
                                    description: 'Name of the referent. More info: https://kubernetes.io/docs/concepts/overview/working-with-objects/names/#names'
                                    type: string
                            tagPrefix:
                              description: TagPrefix is an optional prefix that signature and attestations have. This is the 'tag based discovery' and in the future once references are fully supported that should likely be the preferred way to handle these.
                              type: string
                      static:
                        description: Static specifies that signatures / attestations are not validated but instead a static policy is applied against matching images.
                        type: object
                        properties:
                          action:
                            description: Action defines how to handle a matching policy.
                            type: string
                images:
                  description: Images defines the patterns of image names that should be subject to this policy.
                  type: array
                  items:
                    type: object
                    properties:
                      glob:
                        description: Glob defines a globbing pattern.
                        type: string
                match:
                  description: Match allows selecting resources based on their properties.
                  type: array
                  items:
                    type: object
                    properties:
                      group:
                        type: string
                      resource:
                        type: string
                      selector:
                        type: object
                        properties:
                          matchExpressions:
                            description: matchExpressions is a list of label selector requirements. The requirements are ANDed.
                            type: array
                            items:
                              type: object
                              properties:
                                key:
                                  description: key is the label key that the selector applies to.
                                  type: string
                                operator:
                                  description: operator represents a key's relationship to a set of values. Valid operators are In, NotIn, Exists and DoesNotExist.
                                  type: string
                                values:
                                  description: values is an array of string values. If the operator is In or NotIn, the values array must be non-empty. If the operator is Exists or DoesNotExist, the values array must be empty. This array is replaced during a strategic merge patch.
                                  type: array
                                  items:
                                    type: string
                          matchLabels:
                            description: matchLabels is a map of {key,value} pairs. A single {key,value} in the matchLabels map is equivalent to an element of matchExpressions, whose key field is "key", the operator is "In", and the values array contains only "value". The requirements are ANDed.
                            type: object
                            x-kubernetes-preserve-unknown-fields: true
                      version:
                        type: string
                mode:
                  description: Mode controls whether a failing policy will be rejected (not admitted), or if errors are converted to Warnings. enforce - Reject (default) warn - allow but warn
                  type: string
                policy:
                  description: Policy is an optional policy that can be applied against all the successfully validated Authorities. If no authorities pass, this does not even get evaluated, as the Policy is considered failed.
                  type: object
                  properties:
                    configMapRef:
                      description: ConfigMapRef defines the reference to a configMap with the policy definition.
                      type: object
                      properties:
                        key:
                          description: Key defines the key to pull from the configmap.
                          type: string
                        name:
                          description: Name is unique within a namespace to reference a configmap resource.
                          type: string
                        namespace:
                          description: Namespace defines the space within which the configmap name must be unique.
                          type: string
                    data:
                      description: Data contains the policy definition.
                      type: string
                    fetchConfigFile:
                      description: 'FetchConfigFile controls whether ConfigFile will be fetched and made available for CIP level policy evaluation. Note that this only gets evaluated (and hence fetched) iff at least one authority matches. The ConfigFile will then be available in this format: https://github.com/opencontainers/image-spec/blob/main/config.md'
                      type: boolean
                    includeObjectMeta:
                      description: IncludeObjectMeta controls whether the ObjectMeta will be included and made available for CIP level policy evalutation. Note that this only gets evaluated iff at least one authority matches.
                      type: boolean
                    includeSpec:
                      description: IncludeSpec controls whether resource `Spec` will be included and made available for CIP level policy evaluation. Note that this only gets evaluated iff at least one authority matches. Also note that because Spec may be of a different shape depending on the resource being evaluatied (see MatchResource for filtering) you might want to configure these to match the policy file to ensure the shape of the Spec is what you expect when evaling the policy.
                      type: boolean
                    includeTypeMeta:
                      description: IncludeTypeMeta controls whether the TypeMeta will be included and made available for CIP level policy evalutation. Note that this only gets evaluated iff at least one authority matches.
                      type: boolean
                    remote:
                      description: Remote defines the url to a policy.
                      type: object
                      properties:
                        sha256sum:
                          description: Sha256sum defines the exact sha256sum computed out of the 'body' of the http response.
                          type: string
                        url:
                          description: URL to the policy data.
                          type: string
                    type:
                      description: Which kind of policy this is, currently only rego or cue are supported. Furthermore, only cue is tested :)
                      type: string
            status:
              description: Status represents the current state of the ClusterImagePolicy. This data may be out of date.
              type: object
              properties:
                annotations:
                  description: Annotations is additional Status fields for the Resource to save some additional State as well as convey more information to the user. This is roughly akin to Annotations on any k8s resource, just the reconciler conveying richer information outwards.
                  type: object
                  x-kubernetes-preserve-unknown-fields: true
                conditions:
                  description: Conditions the latest available observations of a resource's current state.
                  type: array
                  items:
                    type: object
                    required:
                      - type
                      - status
                    properties:
                      lastTransitionTime:
                        description: LastTransitionTime is the last time the condition transitioned from one status to another. We use VolatileTime in place of metav1.Time to exclude this from creating equality.Semantic differences (all other things held constant).
                        type: string
                      message:
                        description: A human readable message indicating details about the transition.
                        type: string
                      reason:
                        description: The reason for the condition's last transition.
                        type: string
                      severity:
                        description: Severity with which to treat failures of this type of condition. When this is not specified, it defaults to Error.
                        type: string
                      status:
                        description: Status of the condition, one of True, False, Unknown.
                        type: string
                      type:
                        description: Type of condition.
                        type: string
                observedGeneration:
                  description: ObservedGeneration is the 'Generation' of the Service that was last processed by the controller.
                  type: integer
                  format: int64
    - name: v1beta1
      served: true
      storage: false
      subresources:
        status: {}
      schema:
        openAPIV3Schema:
          type: object
          properties:
            spec:
              description: Spec holds the desired state of the ClusterImagePolicy (from the client).
              type: object
              properties:
                authorities:
                  description: Authorities defines the rules for discovering and validating signatures.
                  type: array
                  items:
                    type: object
                    properties:
                      attestations:
                        description: Attestations is a list of individual attestations for this authority, once the signature for this authority has been verified.
                        type: array
                        items:
                          type: object
                          properties:
                            name:
                              description: Name of the attestation. These can then be referenced at the CIP level policy.
                              type: string
                            policy:
                              description: Policy defines all of the matching signatures, and all of the matching attestations (whose attestations are verified).
                              type: object
                              properties:
                                configMapRef:
                                  description: ConfigMapRef defines the reference to a configMap with the policy definition.
                                  type: object
                                  properties:
                                    key:
                                      description: Key defines the key to pull from the configmap.
                                      type: string
                                    name:
                                      description: Name is unique within a namespace to reference a configmap resource.
                                      type: string
                                    namespace:
                                      description: Namespace defines the space within which the configmap name must be unique.
                                      type: string
                                data:
                                  description: Data contains the policy definition.
                                  type: string
                                fetchConfigFile:
                                  description: 'FetchConfigFile controls whether ConfigFile will be fetched and made available for CIP level policy evaluation. Note that this only gets evaluated (and hence fetched) iff at least one authority matches. The ConfigFile will then be available in this format: https://github.com/opencontainers/image-spec/blob/main/config.md'
                                  type: boolean
                                includeObjectMeta:
                                  description: IncludeObjectMeta controls whether the ObjectMeta will be included and made available for CIP level policy evalutation. Note that this only gets evaluated iff at least one authority matches.
                                  type: boolean
                                includeSpec:
                                  description: IncludeSpec controls whether resource `Spec` will be included and made available for CIP level policy evaluation. Note that this only gets evaluated iff at least one authority matches. Also note that because Spec may be of a different shape depending on the resource being evaluatied (see MatchResource for filtering) you might want to configure these to match the policy file to ensure the shape of the Spec is what you expect when evaling the policy.
                                  type: boolean
                                includeTypeMeta:
                                  description: IncludeTypeMeta controls whether the TypeMeta will be included and made available for CIP level policy evalutation. Note that this only gets evaluated iff at least one authority matches.
                                  type: boolean
                                remote:
                                  description: Remote defines the url to a policy.
                                  type: object
                                  properties:
                                    sha256sum:
                                      description: Sha256sum defines the exact sha256sum computed out of the 'body' of the http response.
                                      type: string
                                    url:
                                      description: URL to the policy data.
                                      type: string
                                type:
                                  description: Which kind of policy this is, currently only rego or cue are supported. Furthermore, only cue is tested :)
                                  type: string
                            predicateType:
                              description: PredicateType defines which predicate type to verify. Matches cosign verify-attestation options.
                              type: string
                      ctlog:
                        description: CTLog sets the configuration to verify the authority against a Rekor instance.
                        type: object
                        properties:
                          trustRootRef:
                            description: Use the Public Key from the referred TrustRoot.TLog
                            type: string
                          url:
                            description: URL sets the url to the rekor instance (by default the public rekor.sigstore.dev)
                            type: string
                      key:
                        description: Key defines the type of key to validate the image.
                        type: object
                        properties:
                          data:
                            description: Data contains the inline public key.
                            type: string
                          hashAlgorithm:
                            description: HashAlgorithm always defaults to sha256 if the algorithm hasn't been explicitly set
                            type: string
                          kms:
                            description: KMS contains the KMS url of the public key Supported formats differ based on the KMS system used.
                            type: string
                          secretRef:
                            description: SecretRef sets a reference to a secret with the key.
                            type: object
                            properties:
                              name:
                                description: name is unique within a namespace to reference a secret resource.
                                type: string
                              namespace:
                                description: namespace defines the space within which the secret name must be unique.
                                type: string
                      keyless:
                        description: Keyless sets the configuration to verify the authority against a Fulcio instance.
                        type: object
                        properties:
                          ca-cert:
                            description: CACert sets a reference to CA certificate
                            type: object
                            properties:
                              data:
                                description: Data contains the inline public key.
                                type: string
                              hashAlgorithm:
                                description: HashAlgorithm always defaults to sha256 if the algorithm hasn't been explicitly set
                                type: string
                              kms:
                                description: KMS contains the KMS url of the public key Supported formats differ based on the KMS system used.
                                type: string
                              secretRef:
                                description: SecretRef sets a reference to a secret with the key.
                                type: object
                                properties:
                                  name:
                                    description: name is unique within a namespace to reference a secret resource.
                                    type: string
                                  namespace:
                                    description: namespace defines the space within which the secret name must be unique.
                                    type: string
                          identities:
                            description: Identities sets a list of identities.
                            type: array
                            items:
                              type: object
                              properties:
                                issuer:
                                  description: Issuer defines the issuer for this identity.
                                  type: string
                                issuerRegExp:
                                  description: IssuerRegExp specifies a regular expression to match the issuer for this identity.
                                  type: string
                                subject:
                                  description: Subject defines the subject for this identity.
                                  type: string
                                subjectRegExp:
                                  description: SubjectRegExp specifies a regular expression to match the subject for this identity.
                                  type: string
                          insecureIgnoreSCT:
                            description: InsecureIgnoreSCT omits verifying if a certificate contains an embedded SCT
                            type: boolean
                          trustRootRef:
                            description: Use the Certificate Chain from the referred TrustRoot.CertificateAuthorities and TrustRoot.CTLog
                            type: string
                          url:
                            description: URL defines a url to the keyless instance.
                            type: string
                      name:
                        description: Name is the name for this authority. Used by the CIP Policy validator to be able to reference matching signature or attestation verifications. If not specified, the name will be authority-<index in array>
                        type: string
                      rfc3161timestamp:
                        description: RFC3161Timestamp sets the configuration to verify the signature timestamp against a RFC3161 time-stamping instance.
                        type: object
                        properties:
                          trustRootRef:
                            description: Use the Certificate Chain from the referred TrustRoot.TimeStampAuthorities
                            type: string
                      source:
                        description: Sources sets the configuration to specify the sources from where to consume the signatures.
                        type: array
                        items:
                          type: object
                          properties:
                            oci:
                              description: OCI defines the registry from where to pull the signature / attestations.
                              type: string
                            signaturePullSecrets:
                              description: SignaturePullSecrets is an optional list of references to secrets in the same namespace as the deploying resource for pulling any of the signatures used by this Source.
                              type: array
                              items:
                                type: object
                                properties:
                                  name:
                                    description: 'Name of the referent. More info: https://kubernetes.io/docs/concepts/overview/working-with-objects/names/#names'
                                    type: string
                            tagPrefix:
                              description: TagPrefix is an optional prefix that signature and attestations have. This is the 'tag based discovery' and in the future once references are fully supported that should likely be the preferred way to handle these.
                              type: string
                      static:
                        description: Static specifies that signatures / attestations are not validated but instead a static policy is applied against matching images.
                        type: object
                        properties:
                          action:
                            description: Action defines how to handle a matching policy.
                            type: string
                images:
                  description: Images defines the patterns of image names that should be subject to this policy.
                  type: array
                  items:
                    type: object
                    properties:
                      glob:
                        description: Glob defines a globbing pattern.
                        type: string
                match:
                  description: Match allows selecting resources based on their properties.
                  type: array
                  items:
                    type: object
                    properties:
                      group:
                        type: string
                      resource:
                        type: string
                      selector:
                        type: object
                        properties:
                          matchExpressions:
                            description: matchExpressions is a list of label selector requirements. The requirements are ANDed.
                            type: array
                            items:
                              type: object
                              properties:
                                key:
                                  description: key is the label key that the selector applies to.
                                  type: string
                                operator:
                                  description: operator represents a key's relationship to a set of values. Valid operators are In, NotIn, Exists and DoesNotExist.
                                  type: string
                                values:
                                  description: values is an array of string values. If the operator is In or NotIn, the values array must be non-empty. If the operator is Exists or DoesNotExist, the values array must be empty. This array is replaced during a strategic merge patch.
                                  type: array
                                  items:
                                    type: string
                          matchLabels:
                            description: matchLabels is a map of {key,value} pairs. A single {key,value} in the matchLabels map is equivalent to an element of matchExpressions, whose key field is "key", the operator is "In", and the values array contains only "value". The requirements are ANDed.
                            type: object
                            x-kubernetes-preserve-unknown-fields: true
                      version:
                        type: string
                mode:
                  description: Mode controls whether a failing policy will be rejected (not admitted), or if errors are converted to Warnings. enforce - Reject (default) warn - allow but warn
                  type: string
                policy:
                  description: Policy is an optional policy that can be applied against all the successfully validated Authorities. If no authorities pass, this does not even get evaluated, as the Policy is considered failed.
                  type: object
                  properties:
                    configMapRef:
                      description: ConfigMapRef defines the reference to a configMap with the policy definition.
                      type: object
                      properties:
                        key:
                          description: Key defines the key to pull from the configmap.
                          type: string
                        name:
                          description: Name is unique within a namespace to reference a configmap resource.
                          type: string
                        namespace:
                          description: Namespace defines the space within which the configmap name must be unique.
                          type: string
                    data:
                      description: Data contains the policy definition.
                      type: string
                    fetchConfigFile:
                      description: 'FetchConfigFile controls whether ConfigFile will be fetched and made available for CIP level policy evaluation. Note that this only gets evaluated (and hence fetched) iff at least one authority matches. The ConfigFile will then be available in this format: https://github.com/opencontainers/image-spec/blob/main/config.md'
                      type: boolean
                    includeObjectMeta:
                      description: IncludeObjectMeta controls whether the ObjectMeta will be included and made available for CIP level policy evalutation. Note that this only gets evaluated iff at least one authority matches.
                      type: boolean
                    includeSpec:
                      description: IncludeSpec controls whether resource `Spec` will be included and made available for CIP level policy evaluation. Note that this only gets evaluated iff at least one authority matches. Also note that because Spec may be of a different shape depending on the resource being evaluatied (see MatchResource for filtering) you might want to configure these to match the policy file to ensure the shape of the Spec is what you expect when evaling the policy.
                      type: boolean
                    includeTypeMeta:
                      description: IncludeTypeMeta controls whether the TypeMeta will be included and made available for CIP level policy evalutation. Note that this only gets evaluated iff at least one authority matches.
                      type: boolean
                    remote:
                      description: Remote defines the url to a policy.
                      type: object
                      properties:
                        sha256sum:
                          description: Sha256sum defines the exact sha256sum computed out of the 'body' of the http response.
                          type: string
                        url:
                          description: URL to the policy data.
                          type: string
                    type:
                      description: Which kind of policy this is, currently only rego or cue are supported. Furthermore, only cue is tested :)
                      type: string
            status:
              description: Status represents the current state of the ClusterImagePolicy. This data may be out of date.
              type: object
              properties:
                annotations:
                  description: Annotations is additional Status fields for the Resource to save some additional State as well as convey more information to the user. This is roughly akin to Annotations on any k8s resource, just the reconciler conveying richer information outwards.
                  type: object
                  x-kubernetes-preserve-unknown-fields: true
                conditions:
                  description: Conditions the latest available observations of a resource's current state.
                  type: array
                  items:
                    type: object
                    required:
                      - type
                      - status
                    properties:
                      lastTransitionTime:
                        description: LastTransitionTime is the last time the condition transitioned from one status to another. We use VolatileTime in place of metav1.Time to exclude this from creating equality.Semantic differences (all other things held constant).
                        type: string
                      message:
                        description: A human readable message indicating details about the transition.
                        type: string
                      reason:
                        description: The reason for the condition's last transition.
                        type: string
                      severity:
                        description: Severity with which to treat failures of this type of condition. When this is not specified, it defaults to Error.
                        type: string
                      status:
                        description: Status of the condition, one of True, False, Unknown.
                        type: string
                      type:
                        description: Type of condition.
                        type: string
                observedGeneration:
                  description: ObservedGeneration is the 'Generation' of the Service that was last processed by the controller.
                  type: integer
                  format: int64
---
# Source: policy-controller/templates/crds/trustroots.yaml
# Copyright 2022 The Sigstore Authors.
#
# Licensed under the Apache License, Version 2.0 (the "License");
# you may not use this file except in compliance with the License.
# You may obtain a copy of the License at
#
#     https://www.apache.org/licenses/LICENSE-2.0
#
# Unless required by applicable law or agreed to in writing, software
# distributed under the License is distributed on an "AS IS" BASIS,
# WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
# See the License for the specific language governing permissions and
# limitations under the License.
apiVersion: apiextensions.k8s.io/v1
kind: CustomResourceDefinition
metadata:
  name: trustroots.policy.sigstore.dev
spec:
  conversion:
    strategy: None
  group: policy.sigstore.dev
  names:
    kind: TrustRoot
    plural: trustroots
    singular: trustroot
    categories:
      - all
      - sigstore
  scope: Cluster
  versions:
    - name: v1alpha1
      served: true
      storage: true
      subresources:
        status: {}
      schema:
        openAPIV3Schema:
          type: object
          properties:
            spec:
              description: Spec is the definition for a trust root. This is either a TUF root and remote or local repository. You can also bring your own keys/certs here.
              type: object
              properties:
                remote:
                  description: Remote specifies initial root of trust & remote mirror.
                  type: object
                  properties:
                    mirror:
                      description: 'Mirror is the remote mirror, for example: https://sigstore-tuf-root.storage.googleapis.com'
                      type: string
                    root:
                      description: Root is the base64 encoded, json trusted initial root.
                      type: string
                    targets:
                      description: Targets is where the targets live off of the root of the Remote If not specified 'targets' is defaulted.
                      type: string
                repository:
                  description: Repository contains the serialized TUF remote repository.
                  type: object
                  properties:
                    mirrorFS:
                      description: MirrorFS is the base64 tarred, gzipped, and base64 encoded remote repository that can be used for example in air-gap environments. Will not make outbound network connections, and must then be kept up to date in some other manner. The repository must contain metadata as well as targets.
                      type: string
                    root:
                      description: Root is the base64 encoded, json trusted initial root.
                      type: string
                    targets:
                      description: Targets is where the targets live off of the root of the Repository above. If not specified 'targets' is defaulted.
                      type: string
                sigstoreKeys:
                  description: SigstoreKeys contains the serialized keys.
                  type: object
                  properties:
                    certificateAuthorities:
                      description: Trusted certificate authorities (e.g Fulcio).
                      type: array
                      items:
                        type: object
                        properties:
                          certChain:
                            description: The certificate chain for this CA in PEM format. Last entry in this chain is the Root certificate.
                            type: string
                          subject:
                            description: The root certificate MUST be self-signed, and so the subject and issuer are the same.
                            type: object
                            properties:
                              commonName:
                                type: string
                              organization:
                                type: string
                          uri:
                            description: The URI at which the CA can be accessed.
                            type: string
                    ctLogs:
                      description: Certificate Transparency Log
                      type: array
                      items:
                        type: object
                        properties:
                          baseURL:
                            description: The base URL which can be used for URLs for clients.
                            type: string
                          hashAlgorithm:
                            description: / The hash algorithm used for the Merkle Tree
                            type: string
                          publicKey:
                            description: PEM encoded public key
                            type: string
                    tLogs:
                      description: Rekor log specifications
                      type: array
                      items:
                        type: object
                        properties:
                          baseURL:
                            description: The base URL which can be used for URLs for clients.
                            type: string
                          hashAlgorithm:
                            description: / The hash algorithm used for the Merkle Tree
                            type: string
                          publicKey:
                            description: PEM encoded public key
                            type: string
                    timestampAuthorities:
                      description: Trusted timestamping authorities
                      type: array
                      items:
                        type: object
                        properties:
                          certChain:
                            description: The certificate chain for this CA in PEM format. Last entry in this chain is the Root certificate.
                            type: string
                          subject:
                            description: The root certificate MUST be self-signed, and so the subject and issuer are the same.
                            type: object
                            properties:
                              commonName:
                                type: string
                              organization:
                                type: string
                          uri:
                            description: The URI at which the CA can be accessed.
                            type: string
            status:
              description: Status represents the current state of the TrustRoot. This data may be out of date.
              type: object
              properties:
                annotations:
                  description: Annotations is additional Status fields for the Resource to save some additional State as well as convey more information to the user. This is roughly akin to Annotations on any k8s resource, just the reconciler conveying richer information outwards.
                  type: object
                  x-kubernetes-preserve-unknown-fields: true
                conditions:
                  description: Conditions the latest available observations of a resource's current state.
                  type: array
                  items:
                    type: object
                    required:
                      - type
                      - status
                    properties:
                      lastTransitionTime:
                        description: LastTransitionTime is the last time the condition transitioned from one status to another. We use VolatileTime in place of metav1.Time to exclude this from creating equality.Semantic differences (all other things held constant).
                        type: string
                      message:
                        description: A human readable message indicating details about the transition.
                        type: string
                      reason:
                        description: The reason for the condition's last transition.
                        type: string
                      severity:
                        description: Severity with which to treat failures of this type of condition. When this is not specified, it defaults to Error.
                        type: string
                      status:
                        description: Status of the condition, one of True, False, Unknown.
                        type: string
                      type:
                        description: Type of condition.
                        type: string
                observedGeneration:
                  description: ObservedGeneration is the 'Generation' of the Service that was last processed by the controller.
                  type: integer
                  format: int64
---
# Source: policy-controller/templates/policy-webhook/clusterrole_policy_webhook.yaml
apiVersion: rbac.authorization.k8s.io/v1
kind: ClusterRole
metadata:
  name: policy-controller-policy-webhook
  labels:
    helm.sh/chart: policy-controller-0.5.5
    app.kubernetes.io/name: policy-controller
    app.kubernetes.io/instance: policy-controller
    app.kubernetes.io/version: "0.7.0"
    app.kubernetes.io/managed-by: Helm
    control-plane: policy-controller-policy-webhook
rules:
  - apiGroups: [""]
    resources: ["events"]
    verbs: ["create", "patch"]
  # Allow the reconciliation of exactly our validating webhook.
  - apiGroups: ["admissionregistration.k8s.io"]
    resources: ["validatingwebhookconfigurations", "mutatingwebhookconfigurations"]
    verbs: ["list", "watch"]

  - apiGroups: ["admissionregistration.k8s.io"]
    resources: ["validatingwebhookconfigurations", "mutatingwebhookconfigurations"]
    verbs: ["get", "update", "delete"]
    resourceNames:
    - "policy.sigstore.dev"
    - "defaulting.clusterimagepolicy.sigstore.dev"
    - "validating.clusterimagepolicy.sigstore.dev"

  - apiGroups: ["admissionregistration.k8s.io"]
    resources: ["validatingwebhookconfigurations/finalizers", "mutatingwebhookconfigurations/finalizers"]
    verbs: ["update"]
    resourceNames:
    - "policy.sigstore.dev"
    - "defaulting.clusterimagepolicy.sigstore.dev"
    - "validating.clusterimagepolicy.sigstore.dev"

  - apiGroups: [""]
    resources: ["namespaces"]
    verbs: ["get", "list"]
    # The webhook configured the namespace as the OwnerRef on various cluster-scoped resources,
    # which requires we can Get the system namespace.
    resourceNames: [ "cosign-system" ]

  - apiGroups: [""]
    resources: ["namespaces/finalizers"]
    verbs: ["update"]
    # The webhook configured the namespace as the OwnerRef on various cluster-scoped resources,
    # which requires we can Get the system namespace.
    resourceNames: [ "cosign-system" ]

  # This is needed by k8schain to support fetching pull secrets attached to pod specs
  # or their service accounts.  If pull secrets aren't used, the "secrets" below can
  # be safely dropped, but the logic will fetch the service account to check for pull
  # secrets.
  - apiGroups: [""]
    resources: ["serviceaccounts", "secrets"]
    verbs: ["get"]

  # Allow reconciliation of the ClusterImagePolic CRDs.
  - apiGroups: ["policy.sigstore.dev"]
    resources: ["clusterimagepolicies", "clusterimagepolicies/status"]
    verbs: ["get", "list", "update", "watch", "patch"]

  - apiGroups: ["apiextensions.k8s.io"]
    resources: ["customresourcedefinitions"]
    verbs: ["get", "list", "watch", "update"]

  - apiGroups: ["apiextensions.k8s.io"]
    resources: ["customresourcedefinitions"]
    verbs: ["get", "update", "list"]
    resourceNames: ["trustroots.policy.sigstore.dev"]

  - apiGroups: ["policy.sigstore.dev"]
    resources: ["trustroots", "trustroots/status"]
    verbs: ["get", "list", "update", "watch", "patch"]
---
# Source: policy-controller/templates/webhook/clusterrole_webhook.yaml
apiVersion: rbac.authorization.k8s.io/v1
kind: ClusterRole
metadata:
  name: policy-controller-webhook
  labels:
    helm.sh/chart: policy-controller-0.5.5
    app.kubernetes.io/name: policy-controller
    app.kubernetes.io/instance: policy-controller
    app.kubernetes.io/version: "0.7.0"
    app.kubernetes.io/managed-by: Helm
    control-plane: policy-controller-webhook
rules:
  - apiGroups: [""]
    resources: ["events"]
    verbs: ["create"]
  # Allow the reconciliation of exactly our validating webhook.
  - apiGroups: ["admissionregistration.k8s.io"]
    resources: ["validatingwebhookconfigurations", "mutatingwebhookconfigurations"]
    verbs: ["list", "watch"]

  - apiGroups: ["admissionregistration.k8s.io"]
    resources: ["validatingwebhookconfigurations", "mutatingwebhookconfigurations"]
    verbs: ["get", "update", "delete"]
    resourceNames: ["policy.sigstore.dev"]

  - apiGroups: [""]
    resources: ["namespaces"]
    verbs: ["get", "list"]
    # The webhook configured the namespace as the OwnerRef on various cluster-scoped resources,
    # which requires we can Get the system namespace.
    resourceNames: [ "cosign-system" ]

  - apiGroups: [""]
    resources: ["namespaces/finalizers"]
    verbs: ["update"]
    resourceNames: [ "cosign-system" ]

  # This is needed by k8schain to support fetching pull secrets attached to pod specs
  # or their service accounts.  If pull secrets aren't used, the "secrets" below can
  # be safely dropped, but the logic will fetch the service account to check for pull
  # secrets.
  - apiGroups: [""]
    resources: ["serviceaccounts", "secrets"]
    verbs: ["get"]
---
# Source: policy-controller/templates/policy-webhook/clusterrolebindings_policy_webhook.yaml
apiVersion: rbac.authorization.k8s.io/v1
kind: ClusterRoleBinding
metadata:
  name: policy-controller-policy-webhook
  labels:
    helm.sh/chart: policy-controller-0.5.5
    app.kubernetes.io/name: policy-controller
    app.kubernetes.io/instance: policy-controller
    app.kubernetes.io/version: "0.7.0"
    app.kubernetes.io/managed-by: Helm
    control-plane: policy-controller-policy-webhook
roleRef:
  apiGroup: rbac.authorization.k8s.io
  kind: ClusterRole
  name: policy-controller-policy-webhook
subjects:
- kind: ServiceAccount
  name: policy-controller-policy-webhook
  namespace: cosign-system
---
# Source: policy-controller/templates/webhook/clusterrolebindings_webhook.yaml
apiVersion: rbac.authorization.k8s.io/v1
kind: ClusterRoleBinding
metadata:
  name: policy-controller-webhook
  labels:
    helm.sh/chart: policy-controller-0.5.5
    app.kubernetes.io/name: policy-controller
    app.kubernetes.io/instance: policy-controller
    app.kubernetes.io/version: "0.7.0"
    app.kubernetes.io/managed-by: Helm
    control-plane: policy-controller-webhook
roleRef:
  apiGroup: rbac.authorization.k8s.io
  kind: ClusterRole
  name: policy-controller-webhook
subjects:
- kind: ServiceAccount
  name: policy-controller-webhook
  namespace: cosign-system
---
# Source: policy-controller/templates/policy-webhook/role_policy_webhook.yaml
kind: Role
apiVersion: rbac.authorization.k8s.io/v1
metadata:
  name: policy-controller-policy-webhook
  namespace: cosign-system
  labels:
    helm.sh/chart: policy-controller-0.5.5
    app.kubernetes.io/name: policy-controller
    app.kubernetes.io/instance: policy-controller
    app.kubernetes.io/version: "0.7.0"
    app.kubernetes.io/managed-by: Helm
    control-plane: policy-controller-policy-webhook
rules:
  # Needed to watch and load configuration and secret data.
  - apiGroups: [""]
    resources: ["configmaps", "secrets"]
    verbs: ["get", "list", "update", "watch"]

  # Needed for leader election
  - apiGroups: ["coordination.k8s.io"]
    resources: ["leases"]
    verbs: ["get", "list", "create", "update", "delete", "patch", "watch"]

  # This is needed to create / patch ConfigMap that is created by the reconciler
  # to consolidate various CIP configuration into a policy ConfigMap.
  - apiGroups: [""]
    resources: ["configmaps"]
    resourceNames: ["config-image-policies"]
    verbs: ["get", "list", "create", "update", "patch", "watch"]

  - apiGroups: ["policy.sigstore.dev"]
    resources: ["trustroots"]
    verbs: ["get", "list"]
---
# Source: policy-controller/templates/webhook/role_webhook.yaml
kind: Role
apiVersion: rbac.authorization.k8s.io/v1
metadata:
  name: policy-controller-webhook
  namespace: cosign-system
  labels:
    helm.sh/chart: policy-controller-0.5.5
    app.kubernetes.io/name: policy-controller
    app.kubernetes.io/instance: policy-controller
    app.kubernetes.io/version: "0.7.0"
    app.kubernetes.io/managed-by: Helm
    control-plane: policy-controller-webhook
rules:
  # Needed to watch and load configuration and secret data.
  - apiGroups: [""]
    resources: ["configmaps", "secrets"]
    verbs: ["get", "list", "update", "watch"]

  # Needed for leader election
  - apiGroups: ["coordination.k8s.io"]
    resources: ["leases"]
    verbs: ["get", "list", "create", "update", "delete", "patch", "watch"]
---
# Source: policy-controller/templates/policy-webhook/rolebinding_policy_webhook.yaml
apiVersion: rbac.authorization.k8s.io/v1
kind: RoleBinding
metadata:
  name: policy-controller-policy-webhook
  namespace: cosign-system
  labels:
    helm.sh/chart: policy-controller-0.5.5
    app.kubernetes.io/name: policy-controller
    app.kubernetes.io/instance: policy-controller
    app.kubernetes.io/version: "0.7.0"
    app.kubernetes.io/managed-by: Helm
    control-plane: policy-controller-policy-webhook
subjects:
- kind: ServiceAccount
  name: policy-controller-policy-webhook
  namespace: cosign-system
roleRef:
  kind: Role
  name: policy-controller-policy-webhook
  apiGroup: rbac.authorization.k8s.io
---
# Source: policy-controller/templates/webhook/rolebinding_webhook.yaml
apiVersion: rbac.authorization.k8s.io/v1
kind: RoleBinding
metadata:
  name: policy-controller-webhook
  namespace: cosign-system
  labels:
    helm.sh/chart: policy-controller-0.5.5
    app.kubernetes.io/name: policy-controller
    app.kubernetes.io/instance: policy-controller
    app.kubernetes.io/version: "0.7.0"
    app.kubernetes.io/managed-by: Helm
    control-plane: policy-controller-webhook
subjects:
- kind: ServiceAccount
  name: policy-controller-webhook
  namespace: cosign-system
roleRef:
  kind: Role
  name: policy-controller-webhook
  apiGroup: rbac.authorization.k8s.io
---
# Source: policy-controller/templates/policy-webhook/service_policy_webhook.yaml
apiVersion: v1
kind: Service
metadata:
  annotations:
  labels:
    helm.sh/chart: policy-controller-0.5.5
    app.kubernetes.io/name: policy-controller
    app.kubernetes.io/instance: policy-controller
    app.kubernetes.io/version: "0.7.0"
    app.kubernetes.io/managed-by: Helm
    control-plane: policy-controller-policy-webhook
  name: policy-webhook
  namespace: cosign-system
spec:
  type: ClusterIP
  ports:
  - name: https
    port: 443
    protocol: TCP
    targetPort: https
  selector:
    app.kubernetes.io/name: policy-controller
    app.kubernetes.io/instance: policy-controller
    control-plane: policy-controller-policy-webhook
---
# Source: policy-controller/templates/policy-webhook/service_policy_webhook.yaml
apiVersion: v1
kind: Service
metadata:
  annotations:
  labels:
    helm.sh/chart: policy-controller-0.5.5
    app.kubernetes.io/name: policy-controller
    app.kubernetes.io/instance: policy-controller
    app.kubernetes.io/version: "0.7.0"
    app.kubernetes.io/managed-by: Helm
    control-plane: policy-controller-policy-webhook
  name: policy-controller-policy-webhook-metrics
  namespace: cosign-system
spec:
  type: ClusterIP
  ports:
  - name: metrics
    port: 9090
    protocol: TCP
    targetPort: metrics
  selector:
    app.kubernetes.io/name: policy-controller
    app.kubernetes.io/instance: policy-controller
    control-plane: policy-controller-policy-webhook
---
# Source: policy-controller/templates/webhook/service_webhook.yaml
apiVersion: v1
kind: Service
metadata:
  annotations:
  labels:
    helm.sh/chart: policy-controller-0.5.5
    app.kubernetes.io/name: policy-controller
    app.kubernetes.io/instance: policy-controller
    app.kubernetes.io/version: "0.7.0"
    app.kubernetes.io/managed-by: Helm
    control-plane: policy-controller-webhook
  name: webhook
  namespace: cosign-system
spec:
  type: ClusterIP
  ports:
  - name: https
    port: 443
    protocol: TCP
    targetPort: https
  selector:
    app.kubernetes.io/name: policy-controller
    app.kubernetes.io/instance: policy-controller
    control-plane: policy-controller-webhook
---
# Source: policy-controller/templates/webhook/service_webhook.yaml
apiVersion: v1
kind: Service
metadata:
  annotations:
  labels:
    helm.sh/chart: policy-controller-0.5.5
    app.kubernetes.io/name: policy-controller
    app.kubernetes.io/instance: policy-controller
    app.kubernetes.io/version: "0.7.0"
    app.kubernetes.io/managed-by: Helm
    control-plane: policy-controller-webhook
  name: policy-controller-webhook-metrics
  namespace: cosign-system
spec:
  type: ClusterIP
  ports:
  - name: metrics
    port: 9090
    protocol: TCP
    targetPort: metrics
  selector:
    app.kubernetes.io/name: policy-controller
    app.kubernetes.io/instance: policy-controller
    control-plane: policy-controller-webhook
---
# Source: policy-controller/templates/policy-webhook/deployment_policy_webhook.yaml
apiVersion: apps/v1
kind: Deployment
metadata:
  name: policy-controller-policy-webhook
  namespace: cosign-system
  labels:
    helm.sh/chart: policy-controller-0.5.5
    app.kubernetes.io/name: policy-controller
    app.kubernetes.io/instance: policy-controller
    app.kubernetes.io/version: "0.7.0"
    app.kubernetes.io/managed-by: Helm
    control-plane: policy-controller-policy-webhook
spec:
  replicas: 1
  selector:
    matchLabels:
      app.kubernetes.io/name: policy-controller
      app.kubernetes.io/instance: policy-controller
      control-plane: policy-controller-policy-webhook
  template:
    metadata:
      labels:
        app.kubernetes.io/name: policy-controller
        app.kubernetes.io/instance: policy-controller
        control-plane: policy-controller-policy-webhook
    spec:
      nodeSelector:
        {}
      tolerations:
        []
      serviceAccountName: policy-controller-policy-webhook
      # To avoid node becoming SPOF, spread our replicas to different nodes.
      affinity:
        podAntiAffinity:
          preferredDuringSchedulingIgnoredDuringExecution:
          - podAffinityTerm:
              labelSelector:
                matchLabels:
                  control-plane: policy-controller-policy-webhook
              topologyKey: kubernetes.io/hostname
            weight: 100
      containers:
      - name: policy-webhook
        # This is the Go import path for the binary that is containerized
        # and substituted here.
        image: "ghcr.io/sigstore/policy-controller/policy-webhook@sha256:3a3581032ff69991ddd9f19faf8acd059c8fb0ba8d3b0164a13b99a096880c84"
        imagePullPolicy: "IfNotPresent"
        args:
        resources:
          limits:
            cpu: 100m
            memory: 256Mi
          requests:
            cpu: 100m
            memory: 128Mi
        env:
        - name: SYSTEM_NAMESPACE
          valueFrom:
            fieldRef:
              fieldPath: metadata.namespace
        - name: CONFIG_LOGGING_NAME
          value: policy-controller-policy-webhook-logging
        - name: CONFIG_OBSERVABILITY_NAME
          value: policy-controller-policy-webhook-observability
        - name: METRICS_DOMAIN
          value: sigstore.dev/policy
        - name: WEBHOOK_NAME
          value: policy-webhook
        ports:
        - containerPort: 8443
          name: https
          protocol: TCP
        - containerPort: 9090
          name: metrics
          protocol: TCP
        securityContext:
          allowPrivilegeEscalation: false
          capabilities:
            drop:
            - ALL
          readOnlyRootFilesystem: true
          runAsNonRoot: true
        volumeMounts:
          # Failing to provide a writable $HOME can cause TUF client initialization to panic
          - mountPath: /home/nonroot
            name: writable-home-dir
        readinessProbe:
          failureThreshold: 6
          initialDelaySeconds: 30
          periodSeconds: 1
          httpGet:
            scheme: HTTPS
            port: 8443
            httpHeaders:
            - name: k-kubelet-probe
              value: "policy-webhook"
        livenessProbe:
          failureThreshold: 6
          initialDelaySeconds: 30
          periodSeconds: 1
          httpGet:
            scheme: HTTPS
            port: 8443
            httpHeaders:
            - name: k-kubelet-probe
              value: "policy-webhook"
      # Our webhook should gracefully terminate by lame ducking first, set this to a sufficiently
      # high value that we respect whatever value it has configured for the lame duck grace period.
      terminationGracePeriodSeconds: 300
      volumes:
      - emptyDir: {}
        name: writable-home-dir
---
# Source: policy-controller/templates/webhook/deployment_webhook.yaml
apiVersion: apps/v1
kind: Deployment
metadata:
  labels:
    helm.sh/chart: policy-controller-0.5.5
    app.kubernetes.io/name: policy-controller
    app.kubernetes.io/instance: policy-controller
    app.kubernetes.io/version: "0.7.0"
    app.kubernetes.io/managed-by: Helm
    control-plane: policy-controller-webhook
  name: policy-controller-webhook
  namespace: cosign-system
spec:
  replicas: 1
  selector:
    matchLabels:
      app.kubernetes.io/name: policy-controller
      app.kubernetes.io/instance: policy-controller
      control-plane: policy-controller-webhook
  template:
    metadata:
      labels:
        app.kubernetes.io/name: policy-controller
        app.kubernetes.io/instance: policy-controller
        control-plane: policy-controller-webhook
    spec:
      nodeSelector:
        {}
      tolerations:
        []
      serviceAccountName: policy-controller-webhook
      # To avoid node becoming SPOF, spread our replicas to different nodes.
      affinity:
        podAntiAffinity:
          preferredDuringSchedulingIgnoredDuringExecution:
          - podAffinityTerm:
              labelSelector:
                matchLabels:
                  control-plane: policy-controller-webhook
              topologyKey: kubernetes.io/hostname
            weight: 100
      containers:
      - name: policy-controller-webhook
        image: "ghcr.io/sigstore/policy-controller/policy-controller@sha256:947693aa3a536992bc89f3c7ded8a7707b26cd4518972f293edd3e57e112438e"
        imagePullPolicy: "IfNotPresent"
        env:
        - name: SYSTEM_NAMESPACE
          valueFrom:
            fieldRef:
              fieldPath: metadata.namespace
        - name: CONFIG_LOGGING_NAME
          value: policy-controller-webhook-logging
        - name: CONFIG_OBSERVABILITY_NAME
          value: policy-controller-webhook-observability
        - name: METRICS_DOMAIN
          value: sigstore.dev/policy
        - name: WEBHOOK_NAME
          value: webhook
        - name: HOME
          value: /home/nonroot
        args:
        ports:
        - containerPort: 8443
          name: https
          protocol: TCP
        - containerPort: 9090
          name: metrics
          protocol: TCP
        resources:
          limits:
            cpu: 100m
            memory: 256Mi
          requests:
            cpu: 100m
            memory: 128Mi
        livenessProbe:
          failureThreshold: 6
          initialDelaySeconds: 30
          periodSeconds: 1
          httpGet:
            port: 8443
            scheme: HTTPS
            path: /healthz
            httpHeaders:
            - name: k-kubelet-probe
              value: "webhook"
        readinessProbe:
          failureThreshold: 6
          initialDelaySeconds: 20
          periodSeconds: 1
          httpGet:
            port: 8443
            scheme: HTTPS
            path: /readyz
            httpHeaders:
            - name: k-kubelet-probe
              value: "webhook"
        securityContext:
          allowPrivilegeEscalation: false
          capabilities:
            drop:
            - ALL
          readOnlyRootFilesystem: true
          runAsUser: 1000
        volumeMounts:
          # Failing to provide a writable $HOME can cause TUF client initialization to panic
          - mountPath: /home/nonroot
            name: writable-home-dir

      # Our webhook should gracefully terminate by lame ducking first, set this to a sufficiently
      # high value that we respect whatever value it has configured for the lame duck grace period.
      terminationGracePeriodSeconds: 300
      volumes:
      - emptyDir: {}
        name: writable-home-dir
---
# Source: policy-controller/templates/policy-webhook/clusterrole_policy_webhook.yaml
# Copyright 2022 The Sigstore Authors.
#
# Licensed under the Apache License, Version 2.0 (the "License");
# you may not use this file except in compliance with the License.
# You may obtain a copy of the License at
#
#     https://www.apache.org/licenses/LICENSE-2.0
#
# Unless required by applicable law or agreed to in writing, software
# distributed under the License is distributed on an "AS IS" BASIS,
# WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
# See the License for the specific language governing permissions and
# limitations under the License.
---
# Source: policy-controller/templates/policy-webhook/clusterrolebindings_policy_webhook.yaml
# Copyright 2022 The Sigstore Authors.
#
# Licensed under the Apache License, Version 2.0 (the "License");
# you may not use this file except in compliance with the License.
# You may obtain a copy of the License at
#
#     https://www.apache.org/licenses/LICENSE-2.0
#
# Unless required by applicable law or agreed to in writing, software
# distributed under the License is distributed on an "AS IS" BASIS,
# WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
# See the License for the specific language governing permissions and
# limitations under the License.
---
# Source: policy-controller/templates/policy-webhook/configmap-clusterimagepolicy.yaml
# Copyright 2022 The Sigstore Authors.
#
# Licensed under the Apache License, Version 2.0 (the "License");
# you may not use this file except in compliance with the License.
# You may obtain a copy of the License at
#
#     http://www.apache.org/licenses/LICENSE-2.0
#
# Unless required by applicable law or agreed to in writing, software
# distributed under the License is distributed on an "AS IS" BASIS,
# WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
# See the License for the specific language governing permissions and
# limitations under the License.
---
# Source: policy-controller/templates/policy-webhook/configmap.yaml
# Copyright 2022 The Sigstore Authors.
#
# Licensed under the Apache License, Version 2.0 (the "License");
# you may not use this file except in compliance with the License.
# You may obtain a copy of the License at
#
#     http://www.apache.org/licenses/LICENSE-2.0
#
# Unless required by applicable law or agreed to in writing, software
# distributed under the License is distributed on an "AS IS" BASIS,
# WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
# See the License for the specific language governing permissions and
# limitations under the License.
---
# Source: policy-controller/templates/policy-webhook/deployment_policy_webhook.yaml
# Copyright 2022 The Sigstore Authors.
#
# Licensed under the Apache License, Version 2.0 (the "License");
# you may not use this file except in compliance with the License.
# You may obtain a copy of the License at
#
#     https://www.apache.org/licenses/LICENSE-2.0
#
# Unless required by applicable law or agreed to in writing, software
# distributed under the License is distributed on an "AS IS" BASIS,
# WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
# See the License for the specific language governing permissions and
# limitations under the License.
---
# Source: policy-controller/templates/policy-webhook/policy_webhook_configurations.yaml
# Copyright 2022 The Sigstore Authors.
#
# Licensed under the Apache License, Version 2.0 (the "License");
# you may not use this file except in compliance with the License.
# You may obtain a copy of the License at
#
#     https://www.apache.org/licenses/LICENSE-2.0
#
# Unless required by applicable law or agreed to in writing, software
# distributed under the License is distributed on an "AS IS" BASIS,
# WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
# See the License for the specific language governing permissions and
# limitations under the License.
---
# Source: policy-controller/templates/policy-webhook/role_policy_webhook.yaml
# Copyright 2022 The Sigstore Authors.
#
# Licensed under the Apache License, Version 2.0 (the "License");
# you may not use this file except in compliance with the License.
# You may obtain a copy of the License at
#
#     https://www.apache.org/licenses/LICENSE-2.0
#
# Unless required by applicable law or agreed to in writing, software
# distributed under the License is distributed on an "AS IS" BASIS,
# WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
# See the License for the specific language governing permissions and
# limitations under the License.
---
# Source: policy-controller/templates/policy-webhook/rolebinding_policy_webhook.yaml
# Copyright 2022 The Sigstore Authors.
#
# Licensed under the Apache License, Version 2.0 (the "License");
# you may not use this file except in compliance with the License.
# You may obtain a copy of the License at
#
#     https://www.apache.org/licenses/LICENSE-2.0
#
# Unless required by applicable law or agreed to in writing, software
# distributed under the License is distributed on an "AS IS" BASIS,
# WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
# See the License for the specific language governing permissions and
# limitations under the License.
---
# Source: policy-controller/templates/policy-webhook/sa_policy_webhook.yaml
# Copyright 2022 The Sigstore Authors.
#
# Licensed under the Apache License, Version 2.0 (the "License");
# you may not use this file except in compliance with the License.
# You may obtain a copy of the License at
#
#     https://www.apache.org/licenses/LICENSE-2.0
#
# Unless required by applicable law or agreed to in writing, software
# distributed under the License is distributed on an "AS IS" BASIS,
# WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
# See the License for the specific language governing permissions and
# limitations under the License.
---
# Source: policy-controller/templates/policy-webhook/secret_certs_policy_webhook.yaml
# Copyright 2022 The Sigstore Authors.
#
# Licensed under the Apache License, Version 2.0 (the "License");
# you may not use this file except in compliance with the License.
# You may obtain a copy of the License at
#
#     https://www.apache.org/licenses/LICENSE-2.0
#
# Unless required by applicable law or agreed to in writing, software
# distributed under the License is distributed on an "AS IS" BASIS,
# WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
# See the License for the specific language governing permissions and
# limitations under the License.
---
# Source: policy-controller/templates/policy-webhook/service_policy_webhook.yaml
# Copyright 2022 The Sigstore Authors.
#
# Licensed under the Apache License, Version 2.0 (the "License");
# you may not use this file except in compliance with the License.
# You may obtain a copy of the License at
#
#     https://www.apache.org/licenses/LICENSE-2.0
#
# Unless required by applicable law or agreed to in writing, software
# distributed under the License is distributed on an "AS IS" BASIS,
# WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
# See the License for the specific language governing permissions and
# limitations under the License.
---
# Source: policy-controller/templates/policy-webhook/policy_webhook_configurations.yaml
apiVersion: admissionregistration.k8s.io/v1
kind: MutatingWebhookConfiguration
metadata:
  name: defaulting.clusterimagepolicy.sigstore.dev
webhooks:
  - admissionReviewVersions:
      - v1
    clientConfig:
      service:
        name: policy-webhook
        namespace: cosign-system
    failurePolicy: Fail
    matchPolicy: Equivalent
    name: defaulting.clusterimagepolicy.sigstore.dev
    sideEffects: None
---
# Source: policy-controller/templates/webhook/webhook_mutating.yaml
apiVersion: admissionregistration.k8s.io/v1
kind: MutatingWebhookConfiguration
metadata:
  name: policy.sigstore.dev
webhooks:
- name: policy.sigstore.dev
  namespaceSelector:    
    matchExpressions:
    - key: policy.sigstore.dev/include
      operator: In
      values:
      - "true"
  admissionReviewVersions: [v1]
  clientConfig:
    service:
      name: webhook
      namespace: cosign-system
  failurePolicy: Fail
  sideEffects: None
  reinvocationPolicy: IfNeeded
---
# Source: policy-controller/templates/policy-webhook/policy_webhook_configurations.yaml
apiVersion: admissionregistration.k8s.io/v1
kind: ValidatingWebhookConfiguration
metadata:
  name: validating.clusterimagepolicy.sigstore.dev
webhooks:
  - admissionReviewVersions:
      - v1
    clientConfig:
      service:
        name: policy-webhook
        namespace: cosign-system
    failurePolicy: Fail
    matchPolicy: Equivalent
    name: validating.clusterimagepolicy.sigstore.dev
    sideEffects: None
---
# Source: policy-controller/templates/webhook/webhook_validating.yaml
apiVersion: admissionregistration.k8s.io/v1
kind: ValidatingWebhookConfiguration
metadata:
  name: policy.sigstore.dev
webhooks:
- name: policy.sigstore.dev
  namespaceSelector:    
    matchExpressions:
    - key: policy.sigstore.dev/include
      operator: In
      values:
      - "true"
  admissionReviewVersions: [v1]
  clientConfig:
    service:
      name: webhook
      namespace: cosign-system
  failurePolicy: Fail
  sideEffects: None
