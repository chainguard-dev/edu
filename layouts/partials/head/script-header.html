{{ if eq (getenv "HUGO_ENV") "production" | or (eq .Site.Params.env "production")  }}
<!-- Preconnect to GTM and GA domains for performance -->
<link rel="preconnect" href="https://www.googletagmanager.com">
<link rel="preconnect" href="https://www.google-analytics.com">
<link rel="dns-prefetch" href="https://www.googletagmanager.com">
<link rel="dns-prefetch" href="https://www.google-analytics.com">
{{ end }}
<meta http-equiv="Content-Security-Policy"
      content="
       default-src 'self';
       frame-src 'self' edu.chainguard.dev https://player.vimeo.com https://www.youtube.com https://www.youtube-nocookie.com https://platform.twitter.com https://syndication.twitter.com https://visualization-ui.chainguard.app https://terminal.inky.wtf;
       style-src 'self' 'unsafe-inline' edu.chainguard.dev https://tagmanager.google.com/ cdn.jsdelivr.net https://fonts.googleapis.com https://unpkg.com https://use.fontawesome.com;
       form-action 'self';
       font-src 'self' edu.chainguard.dev https://fonts.googleapis.com https://fonts.gstatic.com https://cdn.jsdelivr.net https://use.fontawesome.com;
       script-src 'self' 'unsafe-inline' edu.chainguard.dev https://www.googletagmanager.com *.googleapis.com cdn.jsdelivr.net *.googletagmanager.com https://www.google-analytics.com https://snap.licdn.com https://unpkg.com http://localhost:1313 http://localhost:8080;
       connect-src 'self' https://www.googletagmanager.com *.google-analytics.com *.googletagmanager.com https://px.ads.linkedin.com https://storage.googleapis.com https://packages.wolfi.dev https://script.google.com https://script.googleusercontent.com;
       img-src 'self' 'unsafe-inline' https://ssl.gstatic.com edu.chainguard.dev https://storage.googleapis.com https://www.googletagmanager.com https://www.google-analytics.com data:;
       base-uri 'self';
     ">
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">

{{ if .Site.Params.options.darkMode -}}
  {{ $darkModeInit := resources.Get "js/darkmode-init.js" | js.Build | minify | fingerprint "sha512" -}}
  <script src="{{ $darkModeInit.RelPermalink }}" integrity="{{ $darkModeInit.Data.Integrity }}" crossorigin="anonymous" defer></script>
{{ end -}}
{{- if and (.Site.Params.alert) (.Site.Params.alertDismissable) -}}
  {{ $alertInit := resources.Get "js/alert-init.js" | js.Build | minify | fingerprint "sha512" -}}
  <script src="{{ $alertInit.RelPermalink }}" integrity="{{ $alertInit.Data.Integrity }}" crossorigin="anonymous" defer></script>
{{- end -}}

{{ if hugo.IsProduction }}
  {{ partial "googleTagManagerHead.html" . }}
{{ end }}
